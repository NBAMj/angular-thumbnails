var ImageRenderer=function(){function ImageRenderer(scope){this.scope=scope}return ImageRenderer.prototype.render=function(canvas,deferred){var image=new Image;return image.addEventListener("load",function(){var _this=this;this.scope.$apply(function(){var height=_this.scope.maxHeight||image.height,width=_this.scope.maxWidth||image.width,viewport=new RenderingViewport(height,width),context=canvas.getContext("2d");viewport.adjustCanvas(canvas,image.height,image.width),context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height),deferred.resolve()})},!1),image.src=this.scope.source,deferred.promise},ImageRenderer}(),NullRenderer=function(){function NullRenderer(){}return NullRenderer.prototype.render=function(canvas,deferred){return deferred.promise},NullRenderer}(),PaginationStatus=function(){function PaginationStatus(totalPages,currentPage){if(void 0===currentPage&&(currentPage=1),this.totalPages=totalPages,this.currentPage=currentPage,currentPage>totalPages)throw new Error;if(0>currentPage)throw new Error}return PaginationStatus.prototype.getCurrentPage=function(){return this.currentPage},PaginationStatus.prototype.getPageCount=function(){return this.totalPages},PaginationStatus.prototype.isLastPage=function(){return this.getCurrentPage()==this.getPageCount()},PaginationStatus.prototype.isFirstPage=function(){return 1==this.getCurrentPage()},PaginationStatus.prototype.moveToNextPage=function(){return this.getCurrentPage()<this.getPageCount()&&(this.currentPage+=1),this.getCurrentPage()},PaginationStatus.prototype.moveToPreviousPage=function(){return this.getCurrentPage()>1&&(this.currentPage-=1),this.getCurrentPage()},PaginationStatus}(),PdfRenderParams=function(){function PdfRenderParams(canvasContext,viewport){this.canvasContext=canvasContext,this.viewport=viewport}return PdfRenderParams}(),PdfRenderer=function(){function PdfRenderer(scope){this.scope=scope}return PdfRenderer.prototype.render=function(canvas,deferred){var _this=this;return PDFJS.getDocument(this.scope.source,null,null,this.scope.onProgress).then(function(document){_this.scope.$apply(function(){var paginationStatus=new PaginationStatus(_this.scope.pageNum||1,document.numPages);_this.onDocumentReady(canvas,document,paginationStatus,deferred)})},function(error){deferred.reject(error)}),deferred.promise},PdfRenderer.prototype.onDocumentReady=function(canvas,document,paginationStatus,deferred){var _this=this;document.getPage(paginationStatus.getCurrentPage()).then(function(page){_this.onPageReady(canvas,page,deferred)})},PdfRenderer.prototype.onPageReady=function(canvas,page,deferred){var pdfViewport=page.getViewport(this.scope.scale||1,0),height=this.scope.maxHeight||pdfViewport.height,width=this.scope.maxWidth||pdfViewport.width,viewport=new RenderingViewport(height,width);viewport.adjustCanvas(canvas,height,width),pdfViewport=page.getViewport(canvas.height/pdfViewport.height,viewport.getRotation());var params=new PdfRenderParams(canvas.getContext("2d"),pdfViewport);page.render(params).then(function(){deferred.resolve()},function(){deferred.reject()})},PdfRenderer}(),RendererFactory=function(){function RendererFactory(){}return RendererFactory.prototype.getRenderer=function(scope,type){switch(type){case"pdf":return new PdfRenderer(scope);case"image":return new ImageRenderer(scope);case"video":return new VideoRenderer(scope,$(window.document.body))}return new NullRenderer},RendererFactory}(),RenderingViewport=function(){function RenderingViewport(height,width,scale,rotation){void 0===scale&&(scale=1),void 0===rotation&&(rotation=1),this.height=height,this.width=width,this.scale=scale,this.rotation=rotation}return RenderingViewport.prototype.getHeight=function(){return this.height},RenderingViewport.prototype.getWidth=function(){return this.width},RenderingViewport.prototype.getRotation=function(){return this.rotation},RenderingViewport.prototype.adjustCanvas=function(canvas,height,width){var ratio;ratio=width/height,height>this.height&&(height=this.height,width=height*ratio),width>this.width&&(width=this.width,height=width/ratio),canvas.height=height,canvas.width=width},RenderingViewport}(),AngularThumbnail;!function(AngularThumbnail){var Directives;!function(Directives){var Thumbnail=function(){function Thumbnail($q){var _this=this;this.restrict="E",this.scope={source:"=",scale:"=",fileType:"@",maxHeight:"@",maxWidth:"@",onRender:"&",onError:"&"},this.link=function(scope,element,attrs,ctrl){var canvas=document.createElement("canvas"),renderFunc=function(){scope.error=!1,_this.renderer.render(canvas,_this.qService.defer()).then(scope.onRender,scope.onError)};element.append(canvas),_this.renderer=_this.rendererFactory.getRenderer(scope,scope.fileType),scope.thumbnail=element,scope.$watch("source + fileType + scale + maxHeight + maxWidth",renderFunc)},this.rendererFactory=new RendererFactory,this.qService=$q}return Thumbnail.factory=function(){var directive=function($q){return new Thumbnail($q)};return directive.$inject=["$q"],directive},Thumbnail}();angular.module("angular-thumbnails",[]).directive("thumbnail",Thumbnail.factory())}(Directives=AngularThumbnail.Directives||(AngularThumbnail.Directives={}))}(AngularThumbnail||(AngularThumbnail={}));var VideoRenderer=function(){function VideoRenderer(scope,container){this.scope=scope,this.container=container}return VideoRenderer.prototype.render=function(canvas,deferred){var _this=this,video=document.createElement("video");return video.setAttribute("style","display: none"),video.addEventListener("canplay",function(){var height=_this.scope.maxHeight||video.videoHeight,width=_this.scope.maxWidth||video.videoWidth,viewport=new RenderingViewport(height,width),context=canvas.getContext("2d");viewport.adjustCanvas(canvas,video.height,video.width),_this.scope.$apply(function(){context.drawImage(video,0,0,video.videoWidth,video.videoHeight,0,0,canvas.width,canvas.height),deferred.resolve()})}),this.container.append(video),video.src=this.scope.source,deferred.promise},VideoRenderer}();